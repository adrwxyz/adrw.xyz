"use strict";(self.webpackChunkadrw_xyz=self.webpackChunkadrw_xyz||[]).push([[3333],{1173:function(e,t,n){n.d(t,{p:function(){return p},A:function(){return u}});var a=n(6540),r=n(557),i=n(6835),o=n(3328),l=n(7715),s=n(7169);var c=e=>{let{post:t}=e;return null};const m=["16px","8px","4px"].map((e=>"rgba(0, 0, 0, 0.1) 0px "+e+" "+e+" 0px"));var d=e=>{let{data:{post:t},children:n}=e;return(0,r.Y)(o.A,null,(0,r.Y)(i.DZ,{as:"h1",variant:"styles.h1"},t.title),(0,r.Y)("p",{sx:{color:"secondary",mt:3,a:{color:"secondary"},fontSize:[1,1,2]}},(0,r.Y)("time",null,t.date),t.tags&&(0,r.Y)(a.Fragment,null," — ",(0,r.Y)(l.A,{tags:t.tags})),t.timeToRead&&" — ",t.timeToRead&&(0,r.Y)("span",null,t.timeToRead," min read")),(0,r.Y)("section",{sx:{my:5,".gatsby-resp-image-wrapper":{my:[4,4,5],borderRadius:"4px",boxShadow:m.join(", "),".gatsby-resp-image-image":{borderRadius:"4px"}},variant:"layout.content"}},n),(0,r.Y)(c,{post:t}))};const p=e=>{var t,n,a;let{data:{post:i}}=e;return(0,r.Y)(s.A,{title:i.title,description:i.description?i.description:i.excerpt,image:i.banner?null===(t=i.banner)||void 0===t||null===(n=t.childImageSharp)||void 0===n||null===(a=n.resize)||void 0===a?void 0:a.src:void 0,pathname:i.slug,canonicalUrl:i.canonicalUrl})};function u(e){let{...t}=e;return a.createElement(d,t)}},5613:function(e,t,n){n.r(t),n.d(t,{Head:function(){return l.p},default:function(){return s}});var a=n(6540),r=n(8453);function i(e){const t=Object.assign({p:"p",code:"code",a:"a",pre:"pre"},(0,r.RP)(),e.components);return a.createElement(a.Fragment,null,a.createElement(t.p,null,"After 5.5 years of faithful service, one of the drives in my Synology DS916+ 4-bay NAS died."),"\n",a.createElement(t.p,null,"Since I had Synology Hybrid Raid, I could lose one drive and have no data loss. I slotted a new drive in and it rebuilt successfully over a few days."),"\n",a.createElement(t.p,null,"I got a good deal on some higher capacity drives so I decided to add another drive and switch the RAID mode to SHR-2 which can handle the loss of two drives. This RAID expansion ended up running much more slowly and initially was estimated to take over 2 weeks for ~5-6TB of data in 8TB of total capacity."),"\n",a.createElement(t.p,null,"In Synology GUI in ",a.createElement(t.code,null,"Volume Manager > Global Settings"),", there's an option in ",a.createElement(t.a,{href:"https://kb.synology.com/en-us/DSM/help/DSM/StorageManager/storage_pool_adjust_resync_speed?version=6"},"RAID Resync")," to allow for faster speed which made a big difference cutting expansion time down to 1 week."),"\n",a.createElement(t.p,null,"I turned off VMs and other disk heavy services to try and improve throughput but it didn't seem to make much of a difference."),"\n",a.createElement(t.p,null,"Then, I came across ",a.createElement(t.a,{href:"https://gist.github.com/fbartho/2cb998dc1f10d13c124bf736286fd757#file-2-accelerate_expansion-sh"},"this great script")," that allows much more fine tweaking of RAID resync settings than the Synology GUI reveals. Using the script as provided cut resync time from a week to 13 hours."),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,"# Prepare\nsudo su -\n\ncat /sys/block/md2/md/stripe_cache_size\ncat /proc/sys/dev/raid/speed_limit_min\ncat /sys/block/md2/queue/read_ahead_kb\n\ncat /proc/mdstat\n\n# Accelerate RAID Expansion\necho 32768 > /sys/block/md2/md/stripe_cache_size\necho 50000 > /proc/sys/dev/raid/speed_limit_min\necho 32768 > /sys/block/md2/queue/read_ahead_kb\n\n# Cleanup\necho 4096 > /sys/block/md2/md/stripe_cache_size\necho 10000 > /proc/sys/dev/raid/speed_limit_min\necho 512 > /sys/block/md2/queue/read_ahead_kb\n")),"\n",a.createElement(t.p,null,"In the ",a.createElement(t.code,null,"cat /proc/mdstat")," readout, the speed change from initial was ~4000K/sec before Synology GUI change to ~20000K/sec with the faster resync to over ~48000K/sec with the script refinements."),"\n",a.createElement(t.p,null,"Speeding up resync was a big win to reduce the amount of time the RAID volume was in a rebuilding/expanding state."),"\n",a.createElement(t.p,null,"This might not always be the case but while the faster rebuild/expansion was running, my Synology DSM from browser was unavailable which was not ideal but since the expansion was supposed to finish in 13 hours and be done the next day, I decided to let it run."),"\n",a.createElement(t.p,null,"In the case where the DSM browser GUI isn't available, I ",a.createElement(t.a,{href:"https://www.zarino.co.uk/post/synology-package-start-stop/"},"learned")," you can start and stop packages from SSH with the following commands."),"\n",a.createElement(t.pre,null,a.createElement(t.code,null,"$ /usr/syno/bin/synopkg start zerotier\n$ /usr/syno/bin/synopkg stop zerotier\n$ /usr/syno/bin/synopkg list\n...\nzerotier-1.1.1: An Ethernet switch for Earth. Create flat virtual networks of almost unlimited size...\n# The package name is everything before the dash and the version number.\n")))}var o=function(e){void 0===e&&(e={});const{wrapper:t}=Object.assign({},(0,r.RP)(),e.components);return t?a.createElement(t,e,a.createElement(i,e)):i(e)},l=n(1173);function s(e){return a.createElement(l.A,e,a.createElement(o,e))}l.A},7169:function(e,t,n){var a=n(6540),r=n(4194),i=n(7533);t.A=e=>{let{title:t="",description:n="",pathname:o="",image:l="",children:s=null,canonicalUrl:c=""}=e;const m=(0,i.A)(),{siteTitle:d,siteTitleAlt:p,siteUrl:u,siteDescription:h,siteImage:g,author:y,siteLanguage:f}=m,w={title:t?t+" | "+d:p,description:n||h,url:""+u+(o||""),image:""+u+(l||g)};return a.createElement(a.Fragment,null,a.createElement("html",{lang:f}),a.createElement("title",null,w.title),a.createElement("meta",{name:"description",content:w.description}),a.createElement("meta",{name:"image",content:w.image}),a.createElement("meta",{property:"og:title",content:w.title}),a.createElement("meta",{property:"og:url",content:w.url}),a.createElement("meta",{property:"og:description",content:w.description}),a.createElement("meta",{property:"og:image",content:w.image}),a.createElement("meta",{property:"og:type",content:"website"}),a.createElement("meta",{property:"og:image:alt",content:w.description}),a.createElement("meta",{name:"twitter:card",content:"summary_large_image"}),a.createElement("meta",{name:"twitter:title",content:w.title}),a.createElement("meta",{name:"twitter:url",content:w.url}),a.createElement("meta",{name:"twitter:description",content:w.description}),a.createElement("meta",{name:"twitter:image",content:w.image}),a.createElement("meta",{name:"twitter:image:alt",content:w.description}),a.createElement("meta",{name:"twitter:creator",content:y}),a.createElement("meta",{name:"gatsby-theme",content:"@lekoarts/gatsby-theme-minimal-blog"}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"32x32",href:(0,r.withPrefix)("/favicon-32x32.png")}),a.createElement("link",{rel:"icon",type:"image/png",sizes:"16x16",href:(0,r.withPrefix)("/favicon-16x16.png")}),a.createElement("link",{rel:"apple-touch-icon",sizes:"180x180",href:(0,r.withPrefix)("/apple-touch-icon.png")}),c?a.createElement("link",{rel:"canonical",href:c}):null,s)}},7715:function(e,t,n){var a=n(557),r=n(6540),i=n(4194),o=n(3601),l=n(2174);t.A=e=>{let{tags:t}=e;const{tagsPath:n,basePath:s}=(0,o.A)();return(0,a.Y)(r.Fragment,null,t.map(((e,t)=>(0,a.Y)(r.Fragment,{key:e.slug},!!t&&", ",(0,a.Y)(i.Link,{sx:e=>{var t;return{...null===(t=e.styles)||void 0===t?void 0:t.a}},to:(0,l.A)("/"+s+"/"+n+"/"+e.slug)},e.name)))))}}}]);
//# sourceMappingURL=component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx-content-file-path-content-posts-tech-2021-12-28-synology-raid-expansion-md-960d8d4a335412c4222a.js.map